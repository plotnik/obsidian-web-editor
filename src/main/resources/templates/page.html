<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Obsidian Web Editor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        #topbar {
            flex: 0 0 auto;
            padding: 1rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        #content {
            flex: 1 1 auto;
            padding: 0;
        }

        textarea {
            width: 100%;
            height: calc(100vh - 210px);
            /* border: none; */
            resize: none;
            outline: none;
            padding: 1rem;
        }
    </style>
</head>

<body>
    <form method="post" action="/post">
        <!-- Topbar -->
        <div id="topbar" class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-4 mb-2 mb-md-0">
                    <label for="obsidianDropdown" class="form-label">Obsidian</label>
                    <select id="obsidianDropdown" name="obsidianDropdown" class="form-select"
                        th:attr="onchange='notifyServer(\'obsidianDropdown\', this.value)'">
                        <option th:each="obsidianName : ${obsidianNames}" th:text="${obsidianName}"
                            th:selected="${obsidianName == selectedObsidianName}">
                            Option
                        </option>
                    </select>
                </div>
                <div class="col-md-4 mb-2 mb-md-0">
                    <label for="folderDropdown" class="form-label">Folder</label>
                    <select id="folderDropdown" name="folderDropdown" class="form-select"
                        th:attr="onchange='notifyServer(\'folderDropdown\', this.value)'">
                        <option th:each="subfolder : ${subfolders}" th:text="${subfolder}"
                            th:selected="${subfolder == selectedSubfolder}">
                            Option
                        </option>
                    </select>
                </div>
                <div class="col-md-4 mb-2 mb-md-0">
                    <label for="pageDropdown" class="form-label">Page</label>
                    <select id="pageDropdown" name="pageDropdown" class="form-select"
                        th:attr="onchange='notifyServer(\'pageDropdown\', this.value)'">
                        <option th:each="file : ${newestFiles}" th:text="${file}" th:selected="${file == noteName}">
                            Option
                        </option>
                    </select>
                </div>
            </div>
            <div class="row align-items-center">
                <div class="col-md-8 pt-4">
                    <div class="alert alert-primary" role="alert" th:text="${status}">
                        Obsidian Web Editor
                    </div>
                </div>
                <div class="col-md-4 mb-2 mb-md-0 text-end">
                    <div class="small text-muted mb-1">Click Refresh to check for new files</div>
                    <button type="submit" name="action" value="save" class="btn btn-outline-primary">
                        Save
                    </button>
                    <button type="submit" name="action" value="restore" class="btn btn-outline-secondary">
                        Restore
                    </button>
                    <button class="btn btn-outline-secondary" type="button"
                        onclick="notifyServer('obsidianDropdown', '')">
                        Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div id="content">
            <textarea th:text="${noteText}" name="noteText"></textarea>
        </div>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function notifyServer(widget, selectedValue) {
            console.log(
                "[notifyServer] widget: " + widget + ", value: " + selectedValue
            );
            fetch(`/update`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ widget: widget, value: selectedValue }),
            })
                .then((response) => {
                    if (response.ok) {
                        window.location.href = '/';
                    } else {
                        console.error("Server error:", response.statusText);
                    }
                })
                .catch((error) => console.error("Network error:", error));
        }
    </script>
</body>

</html>